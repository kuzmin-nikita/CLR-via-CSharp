## Задачи развёртывания в .NET Framwework

.NET Framework в значительной степени решает "кошмар DLL" (ситуация, когда установка новой программы может повлиять на работоспособность уже установленных) и делает шаг к решению проблемы с распределением данных по всей системе. Совершенствование системы защиты связано с новой моделью безопасности - _безопасностью доступа на уровне кода_ (основана на правах, которые контролируются хостом приложения). 

## Компоновка типов в модуль

Есть простая программа:
```csharp
public sealed class Program
{
  public static void Main()
  {
    System.Console.WriteLine("Hi");
  }
}
```

Её можно скомпилировать командой `csc.exe /out:Program.exe /t:exe /r:MSCorLib.dll Program.cs`. Здесь:
- csc.exe - C Sharp Compilator
- /out:Program.exe - имя создаваемого файла
- /t[arget].exe - тип создаваемого файла (в данном случае консольное приложение Win32, также можно использовать /t:winexe для GUI или /t:appcontainerexe для Windows Store)
- /r[eference]:MSCorLib.dll - сборка для поиска внешних типов

По факту имена исполняемого файла и кода совпадают, можно опустить параметр /t. Как и параметр /r, так как библиотека MSCorLib.dll подгружается автоматически. В итоге получается стандартный PE32.

### Файл параметров

Файл параметров (CSC.rsp по умолчанию или другое имя файла, определённого рядо с проектом) используется для вынесения общих параметров компилятора. Таких, например, как ссылки на все стандартные библиотеки. При компиляции конфиги в командной строке переопределяют локальные конфиги (в текущем каталоге), а локальные - глобальные (рядом с CSC.exe).

## Несколько слов о метаданных

Управляемый PE-файл состоит из 4 блоков:
- Заголовок PE32(+) - стандартная информация, ожидаемая Windows.
- Заголовок CLR - небольшой блок информации, специфичной для модулей, требующих CLR (старший и младший номера версии CLR, ряд флагов, маркер MethodDef, указывающий на точку входа и размер и смещение некоторых таблиц метаданных).
- Метаданные - блок двоичных данных из нескольких таблиц (определений, ссылок и манифестов).
- IL-код

Основные таблицы определений:
- ModuleDef - Одна запись, индентифицирующая модуль (имя файла модуля с расширением и индентификатор версии в виде GUID).
- TypeDef - По одной записи для каждого типа в модуле (имя типа, базовый тип, флаги сборки и указатели на другие таблицы, описывающие члены типа).
- MethodDef - По одной записи для каждого метода в модуле (имя метода, флаги, сигнатуру и смещение в модуле, по которому находится IL-код, а также указатели на ParamDef, где хранятся данные о параметрах метода).
- FieldDef - По одной записи для каждого поля в модуле (тип поля и флаги).
- ParamDef - По одной записи для каждого параметра в модуле (тип, имя и флаги).
- PropertyDef - По одной записи для каждого свойства (имя, флаги, тип и вспомогательное поле, которое может быть пустым).
- EventDef - По одной записи для каждого события (имя и флаги).

Основные таблицы ссылок:
- AssemblyRef - По одной записи для каждой сборки, на которую ссылается модуль (имя, номер версии, региональные стандарты и маркер открытого ключа).
- ModuleRef - По одной записи для каждого PE-модуля, реализующего типы, на которые он ссылается (имя файла сборки и расширение).
- TypeRef - По одной записи для каждого типа, на который ссылается модуль (имя типы и ссылку: TypeRef, Module Def, ModuleRef или AssemblyRef).
- MemberRef - По одной записи для каждого члена типа, на который ссылается модуль (имя и сигнатуру члена, указатель на TypeRef).

## Объединение модулей для создания сборки



### Добавление сборок в проект в среде Visual Studio



### Использование утилиты Assembly Linker



### Включение в сборку файлов ресурсов



## Ресурсы со сведениями о версии сборки



### Номера версии



## Региональные стандарты



## Развёртывание простых приложений (закрытое развёртывание сборок)



## Простое средство администрирования (конфигурационный файл)



### Алгоритм поиска файлов сборки

