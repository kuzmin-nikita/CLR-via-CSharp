## Пул потоков в CLR 

CLR способна управлять собственным пулом потоков, то есть набором готовых потоков, доступных для использования приложениями. Для каждого эземпляра CLR существует свой пул, используемый всеми доменами.

При инициализации CLR пул потоков пуст. Для выполнения прилоением асинхронной оперции вызывается метод, размещающий соответстующий зарпос в очереди пула потоков. Код пула извлекает записи из очереди и распределяет и среди потоков пула. Если пул пуст, создаётся новый поток. По завершении задания поток не уничтожается, а возвращается в пул. Благодаря этому производительность не страдает.

Когда приложение отправляет пулу много запросов, он пытается обслужить их все в одном потоке. Однако если приложение создаёт очередь запросов быстрее, чем поток из пула их обслуживает, создаются дополнительные потоки. Такой подход позволяет обойтись небольшим числом потоков.

Когда приложение прекращает отпраывлять запросы в пул, появляются незанятые потоки. Через некоторое время бездействия поток пробуждается и уничтожается, освобождая ресурсы.

Пул потоков позволяет найти компромисс в ситуации, когда малое количество потоков экономит ресурсы, а большое позволяет воспользоваться преимуществами многопроцессорных систем, а также многоядерных и гиперпоптоковых процессоров.

## Простые вычислительные операции

В разделе описываеся добавление асинхронных вычислительных операций в очередь пула потоков с помощью метода `ThreadPool.QueueUserWorkItem()`.

## Контексты исполнения

С каждым потоком связан определённый контекст исполнения, который включает в себя параметры безопасности, параметры хотса и контекстные данные логического вызова.

По умолчанию CLR автоматически копирует контекст исполнения саммого первого потока во все вспомогательные потоки. Это гарантирует безопасность, но в ущерб производительости. С помощью класса `System.Threading.ExecutionContext` можно запретить копирование контекста, что может сильно повычить быстродействие серверных приложений.

## Скоординированная отмена



## Задания



### Завершение задания и получение результата



### Отмена задания



### Автоматический запуск задания по завершении предыдущего



### Дочерние задания



### Структура задания



### Фабрики заданий



### Планировщики заданий



## Методы For, ForEach и Invoke класса Parallel



## Встроенный язык параллельных запросов



## Периодические выислительные операции



### Разновидности таймеров



## Как пул управляет потоками



### Ограничение количества потоков в пуле



### Управление рабочими потоками

